<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Register</title>
  <link rel="stylesheet" href="../../css/Register.css">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="../../css/style.css">
  <link rel="stylesheet" href="../../css/theme.css">

</head>

<body class="bg-main">
  <section>
    <div class="container">
      <div class="row align-items-center" style="height: 100vh;">
        <!-- Left Image -->
        <div class="col-lg-6 d-none d-lg-flex img-left">
          <img src="../../img/Authentication-amico.png" alt="Authentication" class="img-fluid">
        </div>

        <!-- Register Form -->
        <div class="col-12 col-lg-6">
          <form id="registerForm">
            <h1 class="mb-3">Register</h1>
            <p class="mb-4">Create your account. Itâ€™s free and only takes a minute.</p>

            <div class="row g-3">
              <div class="col-6">
                <input type="text" id="fname" class="form-control" placeholder="First Name">
                <span id="errfname" class="error"></span>
              </div>
              <div class="col-6">
                <input type="text" id="lname" class="form-control" placeholder="Last Name">
                <span id="errlname" class="error"></span>
              </div>
            </div>

            <div class="mt-3">
              <input type="email" id="email" class="form-control" placeholder="Email">
              <span id="erremail" class="error"></span>
            </div>

            <!-- Password -->
            <div class="mt-3 position-relative">
              <input type="password" id="password" class="form-control" placeholder="Password">
              <span class="position-absolute text-main top-50 end-0 translate-middle-y me-3 toggle-password">
                <i class="bi bi-eye-slash" id="eyePassword"></i>
              </span>
              <span id="errpassword" class="error"></span>
            </div>

            <!-- Confirm Password -->
            <div class="mt-3 position-relative">
              <input type="password" id="cpassword" class="form-control" placeholder="Confirm Password">
              <span class="position-absolute text-main top-50 end-0 translate-middle-y me-3 toggle-password">
                <i class="bi bi-eye-slash" id="eyeCPassword"></i>
              </span>
              <span id="errcpassword" class="error"></span>
            </div>

            <!-- Terms Checkbox -->
            <div class="form-check mt-3">
              <input class="form-check-input border-0 bg-main" type="checkbox" checked id="termsCheck">
              <label class="form-check-label" for="termsCheck">
                I accept the <span class="fw-bold text-main">Terms & Privacy Policy</span>
              </label>
            </div>

            <button type="button" class="btn btn-main w-100 mt-4" onclick="signup()">Register</button>

            <div class="text-center mt-3">
              Already have an account? <a href="login.html" class="text-main">Login</a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </section>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const fname = document.getElementById("fname");
    const lname = document.getElementById("lname");
    const email = document.getElementById("email");
    const password = document.getElementById("password");
    const cpassword = document.getElementById("cpassword");

    const errfname = document.getElementById("errfname");
    const errlname = document.getElementById("errlname");
    const erremail = document.getElementById("erremail");
    const errpassword = document.getElementById("errpassword");
    const errcpassword = document.getElementById("errcpassword");

    const eyePassword = document.getElementById("eyePassword");
    const eyeCPassword = document.getElementById("eyeCPassword");

    function signup() {
      // Reset errors
      [errfname, errlname, erremail, errpassword, errcpassword].forEach(el => el.textContent = "");

      // Validation
      if (!fname.value) errfname.textContent = "Enter first name";
      if (!lname.value) errlname.textContent = "Enter last name";
      if (!email.value) erremail.textContent = "Enter email";
      if (!password.value) errpassword.textContent = "Enter password";
      if (password.value !== cpassword.value) errcpassword.textContent = "Passwords do not match";

      // Submit form if valid
      if (fname.value && lname.value && email.value && password.value && password.value === cpassword.value) {
        fetch("http://blogs.csm.linkpc.net/api/v1/auth/register", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            firstName: fname.value,
            lastName: lname.value,
            email: email.value,
            password: password.value,
            confirmPassword: cpassword.value
          }),
        })
          .then(res => res.json())
          .then(data => {
            if (data.result) {
              alert("Registered successfully");
              location.href = "login.html";
            } else {
              alert("Registration failed: " + (data.message || "Unknown error"));
            }
          });
      }
    }

    // Toggle password visibility
    eyePassword.addEventListener("click", () => {
      if (password.type === "password") {
        password.type = "text";
        eyePassword.classList.replace("bi-eye-slash", "bi-eye");
      } else {
        password.type = "password";
        eyePassword.classList.replace("bi-eye", "bi-eye-slash");
      }
    });

    eyeCPassword.addEventListener("click", () => {
      if (cpassword.type === "password") {
        cpassword.type = "text";
        eyeCPassword.classList.replace("bi-eye-slash", "bi-eye");
      } else {
        cpassword.type = "password";
        eyeCPassword.classList.replace("bi-eye", "bi-eye-slash");
      }
    });
  </script>
</body>

</html>