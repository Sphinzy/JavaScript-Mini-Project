<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>My Articles</title>
    <!-- css  -->
    <link rel="stylesheet" href="../../css/style.css" />
    <link rel="stylesheet" href="../../css/theme.css" />
    <!-- icon  -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
      integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />

    <!-- font  -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />

    <!-- boostrap  -->
    <link rel="stylesheet" href="../../bootstrap-5.3.7/css/bootstrap.css" />

    <style>
      .card {
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }

      .thumbnail-img {
        width: 55px;
        height: 40px;
        object-fit: cover;
        border-radius: 6px;
      }

      .badge-category {
        background: var(--bs-sub-main);
        color: var(--bs-color-dark);
        padding: 5px 12px;
        border-radius: 20px;
      }

      .action-icon {
        cursor: pointer;
        font-size: 1.1rem;
      }

      .icon-delete:hover {
        color: #dc3545;
      }

      .icon-edit:hover {
        color: var(--bs-main);
      }
    </style>
  </head>

  <body>
    <div class="container py-5">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2 class="main-title">My Articles</h2>
          <small class="text-muted">Manage your content and publications</small>
        </div>
        <button class="btn btn-main" onclick="location.href='create.html'">
          <i class="bi bi-plus-lg me-2"></i>Create Article
        </button>
      </div>

      <div class="card p-4">
        <div class="table-responsive">
          <table class="table align-middle">
            <thead class="text-secondary small">
              <tr>
                <th>IMAGE</th>
                <th>TITLE</th>
                <th>CATEGORY</th>
                <th>DATE</th>
                <th class="text-center">ACTIONS</th>
              </tr>
            </thead>
            <tbody id="articleTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="modal fade" id="deleteModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow">
          <div class="modal-header">
            <h5 class="modal-title text-danger">Confirm Delete</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            Are you sure you want to delete this article?
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal">
              Cancel
            </button>
            <button class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      const baseUrl = "http://blogs.csm.linkpc.net/api/v1";
      const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOjEwMTgsImlhdCI6MTc2NzA4MDI5OSwiZXhwIjoxNzY3Njg1MDk5fQ.Ir6f1psgdgXRQ2X2In6Z39JPAuplZnka4nIEAieEjxk";

      let deleteId = null;

      function fetchMyArticles() {
        fetch(baseUrl + "/articles/own?_page=1&_per_page=10", {
          headers: { Authorization: "Bearer " + token },
        })
          .then((res) => res.json())
          .then((result) => {
            let rows = "";
            result.data.items.forEach((art) => {
              rows += `
      <tr>
        <td><img src="${
          art.thumbnail || "https://via.placeholder.com/55x40"
        }" class="thumbnail-img"></td>
        <td class="fw-bold">${art.title}</td>
        <td><span class="badge badge-category">${
          art.category?.name || "Uncategorized"
        }</span></td>
        <td class="text-muted small">${new Date(
          art.createdAt
        ).toLocaleDateString()}</td>
        <td class="text-center">
          <i class="bi bi-pencil-square text-muted action-icon mx-2" onclick="editArticle(${art.id})"></i>
          <i class="bi bi-trash text-muted action-icon icon-delete mx-2" onclick="deleteArticle(${
            art.id
          })"></i>
        </td>
      </tr>`;
            });
            document.getElementById("articleTableBody").innerHTML = rows;
          });
      }
      function editArticle(id) {
        window.location.href = "edit.html?id=" + id;
      }

      function deleteArticle(id) {
        deleteId = id;
        new bootstrap.Modal(document.getElementById("deleteModal")).show();
      }

      document
        .getElementById("confirmDeleteBtn")
        .addEventListener("click", () => {
          fetch(baseUrl + "/articles/" + deleteId, {
            method: "DELETE",
            headers: { Authorization: "Bearer " + token },
          }).then((res) => {
            if (res.ok) {
              bootstrap.Modal.getInstance(
                document.getElementById("deleteModal")
              ).hide();
              fetchMyArticles();
            }
          });
        });

      fetchMyArticles();
    </script>
  </body>
</html>
