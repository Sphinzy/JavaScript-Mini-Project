<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Blogify</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="../../bootstrap-5.3.7/css/bootstrap.css" />

  <!-- Custom CSS -->
  <link rel="stylesheet" href="../../css/style.css" />
  <link rel="stylesheet" href="../../css/style.css">

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"/>

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet" />
  <style>
    .post-img {
  max-height: 320px;
  object-fit: cover;
}

@media (max-width: 576px) {
  .post-img {
    max-height: 200px;
  }
}

  </style>
</head>

<body>

<header>
  <nav class="bg-secondary-subtle">
    <div class="container">
      <div class="navbar flex-column flex-md-row gap-2">
  <a class="navbar-brand fw-bold fs-3">Blogify</a>
  <input type="text" class="form-control w-100 w-md-50" placeholder="Search..." />
</div>

    </div>
  </nav>
</header>

<main>
<section>
<div class="container">
<div class="row">

<!-- LEFT MENU -->
<div class="col-md-3 d-none d-lg-block">
  <ul class="navbar-nav mt-5">
    <li class="nav-item"><a class="nav-link fs-5">Home</a></li>
    <li class="nav-item"><a class="nav-link fs-5">Feed</a></li>
    <li class="nav-item"><a class="nav-link fs-5">Profile</a></li>
    <li class="nav-item"><a class="nav-link fs-5">Create</a></li>
  </ul>
</div>

<!-- POSTS -->
<div class="col-md-12 col-lg-6 my-4">
  <div class="row card-insert">
    <!-- POSTS FROM API ONLY -->
  </div>

  <div id="loader" class="text-center my-4" style="display:none;">
    Loading more posts...
  </div>
</div>

</div>
</div>
</section>
</main>

<script>
function likePost(btn){
  btn.classList.toggle("text-primary");
  btn.innerHTML = btn.classList.contains("text-primary")
    ? '<i class="fa-solid fa-thumbs-up"></i> Liked'
    : '<i class="fa-regular fa-thumbs-up"></i> Like';
}

function toggleComment(btn){
  const box = btn.closest(".post").querySelector(".comment-box");
  box.style.display = box.style.display === "none" ? "block" : "none";
}

function sharePost(){
  alert("Post shared!");
}

function timeAgo(dateString){
  const now = new Date();
  const postDate = new Date(dateString);
  const diff = Math.floor((now - postDate) / 1000);

  if (diff < 60) return "Just now";
  if (diff < 3600) return Math.floor(diff/60) + " minutes ago";
  if (diff < 86400) return Math.floor(diff/3600) + " hours ago";
  if (diff < 604800) return Math.floor(diff/86400) + " days ago";
  return postDate.toLocaleDateString();
}

let currentPage = 1;
let loading = false;
const loader = document.getElementById("loader");

function loadMoreArticles(){
  loading = true;
  loader.style.display = "block";

  fetch(`http://blogs.csm.linkpc.net/api/v1/articles?_page=${currentPage}&_per_page=10`)
    .then(res => res.json())
    .then(data => {
      console.log(data);
      console.table(data);
      data.data.items.forEach(article => {
        document.querySelector(".card-insert").innerHTML += `
        <div class="post pb-5">
          <div class="d-flex gap-2">
             <a href="UserProfile.html?id=${article.creator.id}" class="d-flex align-items-center text-decoration-none text-dark">
          <img src="${article.creator.avatar || 'assets/default-avatar.png'}" class="rounded-circle" width="45" height="45">
          <div class="ms-2">
            <h6 class="mb-0">${article.creator.firstName} ${article.creator.lastName}</h6>
            <small class="text-muted">${timeAgo(article.createdAt)}</small>
          </div>
        </a>
          </div>
        <a href="detail.html?id=${article.id}">
           <img src="${article.thumbnail}" class="w-100 mt-2" style="height:300px;object-fit:cover">
        </a>
         

          <h5 class="mt-2">${article.title}</h5>
          <p>${article.description || ""}</p>

          <div class="post-actions d-flex justify-content-around border-top pt-2">
            <button class="btn btn-light" onclick="likePost(this)">
              <i class="fa-regular fa-thumbs-up"></i> Like
            </button>
            <button class="btn btn-light" onclick="toggleComment(this)">
              <i class="fa-regular fa-comment"></i> Comment
            </button>
            <button class="btn btn-light" onclick="sharePost()">
              <i class="fa-solid fa-share"></i> Share
            </button>
          </div>

          <div class="comment-box mt-2" style="display:none;">
            <input class="form-control" placeholder="Write a comment..." />
          </div>
        </div>`;
      });

      currentPage++;
      loading = false;
      loader.style.display = "none";
    });
}

window.addEventListener("scroll", () => {
  if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 200 && !loading) {
    loadMoreArticles();
  }
});

loadMoreArticles(); // load on page open
</script>

</body>
</html>
